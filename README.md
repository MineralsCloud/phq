# phmd: First-Principles Anharmonic Free Energy of Complex Crystals from Phonon Quasiparticle

[TOC]

This repo is created by [Zhen Zhang](mailto:zhenzhang305@hotmail.com).

## Installation Instructions

phmd program can be installed on Linux, macOS and Windows systems by gfortran, ifort (recommended) or other fortran compilers. The source codes are in the src folder and the makefiles are in the system folder. Simply copy one of the suitable makefiles from system folder and paste it in the src folder and rename it as "makefile". Run:

```shell
$ make
```

The phmd executable file is compiled. 

The source codes work as following:

1. `configure.f90` contains 3 auxiliary modules, which configure the physical quantities, parameters and text readin settings.

2. `main.f90` the main module, which performs the normal mode projection and anharmonic phonon extraction and so forth.

3. `phmd.f90`  runs the program.

## Input Files

There are 4 input files needed, which can be prepared according to the example provided:

1. `input` settings to control the run. `dt` should be in atomic unit. `pole` parameter used in the maximum entropy method which should be less than the ``step_md_use``. `step_md_use` number of molecular dynamics steps that is going to be used. `correlation_time` correlation time which should be less than the `step_md_use`. `block` parameter used in Fourier transformation and the default setting is 1.
2. `scf.out` self-consistent results of your system.`lattice_parameter` should be in unit of Bohr radius. `natom` is the number of atoms in your primitive cell. `ATOMIC_POSITIONS` are in reduced coordinate. `RECIPROCAL_AXES` are in cardesian coordinate in unit of $2\pi$/`lattice_parameter`. `q-points` are in the order as generated by Monkhorst-Pack method in reduced coordinate.
3. `dyn.out` harmonic phonon results from Quantum ESPRESSO ph.x output. `q` should be in the same order as `q-points` provided in `scf.out`. This is usually done automatically by the computational software since Monkhorst-Pack method is usually adopted. `freq` and the following two columns of `eigenvector` are necessary. `Dynamical Matrix` are unnecessary if you use other computational software to calculate harmonic phonon. `Dielectric Tensor` and `Effective Charges` depend on whether you need to consider LO-TO splitting in your system.  
4. `md.out` molecular dynamics results. `types` is the number of elements in your system. `total_step` equals the total actual molecular dynamics steps plus the initial position. However, you can start recording your desired step from wherever you want in the `md.out` file. `ATOMIC_POSITIONS` of each step are necessary and in reduced coordinate of your supercell lattice vectors. It is important to know that the order of atoms in each of the primitive cell should be in the same order as provided in `scf.out`. Then the primitive cell is expanded according to Monkhorst-Pack method. So in the `md.out` file, atoms in one primitive cell should be together instead of same kind of atoms being together.

## Executing the Program

After putting the phmd executable in the same folder with the input files, run:

```shell
$ ./phmd < input
```

## Output Files

The main output files of phmd are as following:

1. `corr.vaf` velocity autocorrelation functions of each normal mode .
2. `corr_fit.vaf` fitted curves of correlation functions according to phonon quasiparticle and anharmonic perturbation theory.
3. `corr_fourier.vaf` Fourier transformation of correlation functions.
4. `frequency.freq` Harmonic phonon frequencies, curve fitted renormalized phonon frequencies, Fourier transformed renormalized phonon frequencies and maximum entropy method renormalized phonon frequencies.
5. `tau_fit.tau` fitted phonon quasiparticles' lifetime.
6. `vector_q.out` eigenvectors of the primitive cell.
7. `vector.out` eigenvectors of the supercell.
8. `harmonic_matrix.mat` harmonic force constants.
9. `gamma_matrix.mat` effective harmonic force constant matrix.
10. `dynamical_matrix_md.mat` effective harmonic dynamical matrices.
11. `dynmatmd` renormalized phonon information with the same format of ph.x executable's output in the Quantum ESPRESSO suite. All post processing can be started from here.

## Post Processing

The output `dynmatmd` files from phmd can be read in by the q2r.x executable in the Quantum ESPRESSO suite. Effective harmonic force constants, renormalized phonon dispersions, anharmonic entropy and free energy can be obtained from q2r.x output. If other Fourier interpolation program is used, either extract the effective harmonic dynamical matrices from `dynmatmd` files or use the effective harmonic force constant matrix file `gamma_matrix.mat` to fit to the format.

## Example

There is an example of diamond silicon in the `examples` folder.

## License

[GNU General Public License v3](./LICENSE.txt)

